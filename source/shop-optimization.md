# Оптимизация времени поиска

Операция поиска вариантов перелета является одной из самых критичных операций с точки зрения времени ожидания ответа. Увеличение времени ожидания поисковых результатов может приводить к серьезному снижению показателя конверсии. Среднее время ожидания ответа на поисковый запрос (One Way или Round Trip) Sabre составляет 2-3 секунды. Если у вашего решения это время выше, то рекомендуется ознакомиться c перечисленными ниже рекомендациями:
1. Обновите версии используемых поисковых сервисов до текущих. Текущие версии поисковых сервисов можно узнать на портале Sabre Dev Studio: [Bargain Finder Max](https://developer.sabre.com/docs/soap_apis/air/search/bargain_finder_max), [Bargain Finder Alternate Date](https://developer.sabre.com/docs/soap_apis/air/search/bargain_finder_max/bfm_ad).
2. Используйте токены вместо сессий для аутентификации в Sabre. За счет долгого времени жизни и возможности отправки параллельных запросов через один токен пропадает необходимость создавать токен перед каждым запросом. Рекомендуется создавать один токен раз в неделю или при инвалидации предыдущего и использовать его для всех всех поисковых запросов. Подробнее см. [Аутентификация](authentication.md).
3. Используйте в качестве адреса для отправки запросов ```https://webservices.havail.sabre.com```.
4. Используйте компрессию данных на уровне HTTP протокола для всех отправляемых запросов. Для этого необходимо указать в HTTP-заголовках запросов параметр ```Accept-Encoding``` со значением ```gzip, deflate```.
5. Выберите провайдера с быстрым каналом до США, т.к. именно там расположены сервера Sabre.
6. Используйте [постоянное HTTP соедиенение](http://files.developer.sabre.com/doc/developmentpatterns/Sabre-APIs-Persistent-Connections.pdf) (HTTP persistent connection).
7. Не отправляйте несколько поисковых запросов в Sabre или другие системы для одного запроса пользователя. Если это невозможно, то не ждите выполнения всех запросов, а показывайте пользователю данные по мере их появления.
8. Запрашивайте меньше [вариантов перелетов](shop.md#kolichestvo_variantov_pereletov), если это некритично для результатов поиска.
9. Используйте [группированный вид ответа](shop.md#vid_otveta) (Grouped Itinerary Response, GIR) в сервисах BargainFinderMaxRQ и BargainFinderMax_ADRQ.
10. Не используйте функции, которые увеличивают размер ответа и, как следствие, время ответа. Например, функции для получения:
    - [расчетов стоимости по всем доступным брендам](shop.md#raschet_stoimosti_po_vsem_dostupnim_brendam) (Multiple Branded Fares) — в качестве альтернативы может быть рассмотрен алгоритм выбора бренда в отдельном запросе после выбора перелета в результатах поиска. Подробнее см. [Брендированные тарифы](brands.md).
    - [дополнительных тарифов](shop.md#zapros_dopolnitelnih_tarifov_multiple_fares_per_itinerary) (Multiple Fares per Itinerary)
    - списка [дополнительных услуг](shop.md#dopolnitelnie_uslugi) — список дополнительных услуг для перелета может быть получен в отдельном запросе. Подробнее см. [Бронирование дополнительных услуг](ancillaries.md).
    - условий [обмена и возврата билетов](shop.md#obmen_i_vozvrat_biletov) — условия обмена и возврата билетов могут быть получены в отдельном запросе. Подробнее см. [Получение структурированных правил тарифов](structure-fare-rules.md).
    - вариантов перелетов с [оформлением на нескольких билетах](shop.md#oformlenie_na_neskolkih_biletah) — если использование этой функции необходимо, то рекомендуется использовать режим ```SCHS```, как наиболее компактный.
    - [дополнительных прямых перелетов](shop.md#dopolnitelnie_pryamie_pereleti)
