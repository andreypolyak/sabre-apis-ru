# Конфигурация Sabre

-----

**Оглавление:**
<!-- toc -->

-----

## PCC

**PCC** (Pseudo City Code) — уникальный идентификатор точки продаж (офиса) в системе Sabre. Именно по этому идентификатору Sabre и перевозчики идентифицируют агентства.

Одно агентство может иметь несколько PCC, например, для разных точек продаж или разных целей (например, для бронирования и оформления билетов).

При работе через Sabre APIs используется специальный вид PCC — **iPCC** (Internet PCC). В iPCC подключен инструмента для поиска перелетов с минимальной ценой — [Bargain Finder Max (BFM)](shop.md). Также iPCC используется для создания сессий для работы с сервисами Sabre. Во всех остальных аспектах iPCC ничем не отличается от любого другого PCC.

Разные PCC могут быть использованы для следующих целей:
- поиск вариантов перелетов (всегда используется iPCC)
- создание бронирования
- оформление авиабилета

В рекомендуемом рабочем процессе в данном Руководстве рассмотрены следующие варианты:
- поиск и бронирование осуществляются в iPCC, оформление билета в другом (или других) PCC
- поиск, бронирование и оформление билетов осуществляются в iPCC

## Доступ в другой PCC (Branch Access)

При работе с Sabre можно переключаться или переходить из одного PCC в другой, для этого предусмотрен механизм открытия доступа — **[Branch Access](https://central.sabre.com/s/article/how-to-open-a-branch)**.

Branch Access определяет уровень доступа из одного PCC в другой PCC. В Sabre следующие уровни доступы:
- ```B``` — доступ к данным PCC (бронирования, билеты, терминальные адреса принтеров, профили и т.д.) из другого PCC. Например, данный уровень доступа позволяет, зная код бронирования, открыть бронирование, которое было сделано в другом PCC и произвести в нем изменения.
- ```C``` (или ```BC```) — возможность перейти в другой PCC. Для того чтобы установить такой уровень доступа из PCC AAAA в PCC BBBB необходимо, чтобы между ними был уровень доступа B в обе стороны (т.е. PCC AAAA имеет доступ к данным в PCC BBBB и наоборот). Например, данный уровень доступа позволяет перейти в другой PCC и выписать в нем билет в бронировании, которое было создано в оригинальном PCC.
- ```D``` (или ```BD```) — аналогично уровню ```C```, но без возможности изменения настроек в PCC, в котором будет произведен PCC.

Уровни доступа не передаются в другие PCC каскадно. Т.е., например, наличие между PCC AAAA и PCC BBBB, а также между PCC BBBB и PCC CCCC уровня доступа ```C``` не означает то, что из PCC AAAA можно перейти в PCC CCCC.

## Настройки PCC (TJR)

См. [Настройки PCC](tjr-settings.md).

## Учетные записи пользователей (EPR)

PCC могут содержать учетные записи пользователей, которые называются **[EPR (Employee Profile Record)](https://central.sabre.com/s/article/display-employee-profile-records-epr-h)**. Каждая учетная запись состоит из следующих параметров:
- имя пользователя (Agent ID, Username, Login) — содержит от 1 до 6 цифр и используется для авторизации в системе
- подпись агента (Agent Sign) — содержит 3 символа первый из которых "A", используется в качестве идентификатора агента в истории операций
- пароль (Passcode, Password) — содержит 7 или 8 символов
- ключевые слова (Keywords) — каждое ключевое слово содержит 6 букв, используются для подключения определенных функций в системе для данной учетной записи

### Обязательные настройки EPR

Обязательные ключевые слова для учетной записи, которая используется для создания сессий для работы через Sabre APIs:
- ```SUBAAA``` — возможность перейти в другой PCC
- ```BSRDSP``` — возможность получить курсы валют

### Смена пароля и разблокировка EPR

EPR в Sabre автоматически блокируются после нескольких неуспешных попыток авторизоваться в системе с неверным паролем (например, при создании [сессии или токена](authentication.md)) или после 90 дней неактивности. При попытке создать сессию или токен через заблокированную учетную запись, система будет возвращать ошибку ```USG_AUTHENTICATION_FAILED``` в ответе. Для разблокировки EPR необходимо выполнить следующие действия:
1. разблокировать EPR и установить временный пароль
2. установить постоянный пароль

Разблокировать EPR и установить временный пароль можно несколькими способами:
- в терминале агентом с ключевым словом ```CREATE``` или ```PASRES``` (EPR агента должен быть в том PCC, у которого SC код совпадает с SC кодом iPCC, для которого вы хотите установить пароль)
- обратившись в [глобальную службу поддержки Sabre APIs](mailto:webservices.support@sabre.com)

Установить постоянный пароль можно по следующим ссылкам:
- [тестовая (CERT) среда](https://accounts.cert.havail.sabre.com/login/sc)
- [боевая (PROD) среда](https://accounts.havail.sabre.com/login/sc)

## Терминальные адреса (TA, LNIATA)

В Sabre используется три типа терминальных адресов:
- ```CRTTA``` — терминальный адрес пульта (рабочего места) пользователя. Используется только для доступа пользователей к системе Sabre через терминал Sabre Red Workspace. Для работы c Sabre через Sabre APIs вместо ```CRTTA``` используются [сессии](authentication.md)
- ```PTRTA``` — терминальный адрес принтера. Должен быть указан в системе перед оформлением, войдированием, обменом и возвратом билета или EMD. В случае необходимости печати или сохранения купонов данный ```PTRTA``` должен быть использован в приложении [Sabre Java Printing Module](https://central.sabre.com/s/contentdocument/0691C00000AKeY1QAL). В случае наличия между двумя PCC открытого доступа (Branch Access) в одном PCC можно использовать ```PTRTA``` из другого PCC
- ```MINITA``` — терминальный адрес для взаимодействия с системой отчетности. Используется для получения обменных файлов (также называются IUR-файлы) с информацией о продажах. Для получения обменных файлов также используется приложение [Sabre Java Printing Module](https://central.sabre.com/s/contentdocument/0691C00000AKeY1QAL)

Каждый терминальный адрес состоит из 6 букв или цифр. Терминальный адрес обязательно должен принадлежать какому-либо PCC. В каждом PCC может быть неограниченное количество ```CRTTA``` и ```PTRTA```, но не более одного ```MINITA```.

Для заказа терминальных адресов в любых PCC, кроме iPCC используется система Sabre Order. Для заказа терминальных адресов в iPCC (только ```PTRTA``` и ```MINITA```) необходимо обратиться к вашему куратору в Sabre.

Для получения списка терминальных адресов в PCC используется терминальная команда ```PE*[PCC]```. Терминальные команды можно отправить при помощи сервиса [SabreCommandLLSRQ](commands.md) или в терминале Sabre Red Workspace.

Например, для получения списка терминальных адресов в PCC 8XFG необходимо отправить терминальную команду ```PE*8XFG```.

Пример ответа системы:

```
LNIATA    TYPE            TAPOOL  POOL IND                      
-------------------------------------------                     
                                                                
5C0984-92 CRT    3RDPTY                                         
5C0993    PTR    3RDPTY                                         
CBACEF-F1 CRT    3RDPTY                                         
CBACF2    MINI                                                  
CBACF3    PTR    3RDPTY                                         
DC626F    CRT    3RDPTY                                         
DC6270    PTR    3RDPTY                                         
E8B178    PTR    3RDPTY                                         
E8BC8F    CRT    3RDPTY                                         
```

***Обратите внимание на то, что для получения обменных файлов (IUR файлов) с информацией о продажах необходимо не только заказать ```MINITA```, но и активизировать возможность формирования этих файлов. Для этого необходимо отправить заявку в [Sabre Helpdesk](http://airts.ru/contacts) по электронной почте в свободной форме.***

## Валидатор

Валидатор — это уникальный идентификатор, присваиваемый агентству IATA, ТКП или авиакомпанией. IATA и ТКП присваивают агентству уникальный номер, когда агентство получает аккредитацию и начинает работать в системе взаиморасчётов BSP (IATA) и СВВТ (ТКП) соответственно. Агентство также может иметь идентификатор, присвоенный ему авиакомпанией, в рамках заключения прямого агентского соглашения. Присвоенный агентству идентификатор (валидатор) указывается в TJR.

Для установки валидатора в PCC необходимо отправить заявку в Sabre Helpdesk по электронной почте в свободной форме.

## Приватные тарифы

При работе с приватными тарифами необходимо убедиться, что они будут зафайлированы в тех PCC, в которых производится поиск, бронирование и оформление билетов.

## Работа с зарубежными PCC

При работе с зарубежными PCC необходимо следовать правилу, при котором для каждого бронирования совпадает:
- национальная принадлежность PCC, в котором было произведено бронирование
- национальная принадлежность PCC, в котором было произведено оформление билетов
- валюта расчета
- страна, к которой относится валидатор в PCC, в котором было произведено оформление билетов
